name: Move Verified SQL to TST

on:
  pull_request:
    types: [labeled]

jobs:
  move_file:
    if: github.event.label.name == 'Verified'
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Find SQL files in AX1/Flex Business Rules
        id: find_sql
        run: |
          FILES=$(git ls-files "AX1/Flex Business Rules/*.sql")
          echo "files=$FILES" >> $GITHUB_OUTPUT

      - name: Stop if no SQL files found
        if: steps.find_sql.outputs.files == ''
        run: |
          echo "No SQL files in AX1/Flex Business Rules to move."
          exit 0

      - name: Move files to TST/Flex Business Rules
        run: |
          for f in ${{ steps.find_sql.outputs.files }}; do
            DEST="TST/Flex Business Rules/$(basename "$f")"
            mkdir -p "TST/Flex Business Rules"
            git mv "$f" "$DEST"
            echo "Moved: $f --> $DEST"
          done

      - name: Commit & Push Changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git commit -am "Auto-moved verified SQL from AX1 â†’ TST"
          git push
